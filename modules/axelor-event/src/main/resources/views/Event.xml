<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

  <grid model="com.axelor.event.db.Event" title="Event" name="event-grid">
    <field name="reference"></field>
    <field name="startDate"></field>
    <field name="endDate"></field>
    <field name="registrationOpen"></field>
    <field name="registrationClose"></field>
    <field name="capacity"></field>
    <field name="eventFees"></field>
    <field name="totalEntry"></field>
    <field name="amountCollected"></field>
    <field name="totalDiscount"></field>
  </grid>

  <form model="com.axelor.event.db.Event" title="Event" name="event-form"
    onSave="action-method-event-validate-registration-on-save">

    <toolbar>
      <button name="importRegistration" title="Import Registration" onClick="action-view-for-registration-popup" showIf="id" />
      <button name="print" title="print Event" showTitle="false"
        onClick="action-report-print-event-on-click"
        icon="fa-print" showIf="id" />
    </toolbar>

    <panel title="Event OverView">
      <field name="reference"></field>
      <field name="startDate" onChange="action-validate-date"></field>
      <field name="endDate" onChange="action-validate-date"></field>
      <field name="venue" colSpan="10"></field>
      <field name="registrationOpen" onChange="action-validate-date"></field>
      <field name="registrationClose" onChange="action-validate-date"></field>
      <field name="capacity"></field>
      <field name="eventFees" onChange="action-method-for-amount-in-event-registration"></field>
      <field name="description" colSpan="4"></field>
      <field name="discountList" colSpan="10" onChange="action-method-for-amount-in-event-registration"></field>
      <field name="eventRegistrationList" form-view="eventRegistration-form" colSpan="10"
        onChange="action-attrs-for-totalEntry"></field>
      <field name="totalEntry"></field>
      <field name="amountCollected"></field>
      <field name="totalDiscount"></field>
    </panel>
  </form>

  <action-method name="action-method-event-validate-registration-on-save">
    <call class="com.axelor.event.web.EventController" method="validateRegistration" />
  </action-method>

  <action-attrs name="action-attrs-for-totalEntry">
    <attribute name="value" for="totalEntry" expr="eval: eventRegistrationList.size()" />
  </action-attrs>

  <action-validate name="action-validate-date">
    <error message="start date should not be ahead of End Date"
      if="startDate!= null &amp;&amp; endDate!=null &amp;&amp;  startDate &gt; endDate" />
    <error message="Registration Open date should not be ahead of Registration Close Date"
      if="registrationOpen!= null &amp;&amp; registrationClose!=null &amp;&amp;  registrationOpen &gt; registrationClose" />
    <error message="Registration close date must be before event start date"
      if="registrationClose!=null &amp;&amp; startDate!= null &amp;&amp; registrationClose &gt; startDate.date" />
  </action-validate>

  <action-method name="action-method-for-amount-in-event-registration">
    <call class="com.axelor.event.web.EventController" method="updateAmount" />
  </action-method>
  
  <action-view name="action-view-for-registration-popup" title="event Registration Popup" model="com.axelor.event.db.Event">
    <view type="form" name="event-registration-form-popup" />
    <view-param name="popup" value="true" />
    <view-param name="show-toolbar" value="false" />
    <view-param name="show-confirm" value="false" />
    <view-param name="popup-save" value="false" />
    <context name="showRecord" expr="eval: id" />
  </action-view>

</object-views>
